<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∞—Ç</title>

    <script>
        (function() {
            try {
                let theme = localStorage.getItem('theme');
                if (theme) {
                    document.documentElement.setAttribute('data-theme', theme);
                    document.body.setAttribute('data-theme', theme);
                }
            } catch (e) { console.warn('Could not apply theme from localStorage', e); }
        })();
    </script>
    <link rel="stylesheet" href="/css/chats.css">
    <link rel="stylesheet" href="/css/chats_mobile.css">
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="/css/my-profile.css">
    <link rel="stylesheet" href="/css/photoViewer.css">
</head>
<body>

<!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
<div class="container">
    <!-- –í–µ—Ä—Ö–Ω—è—è —à–∞–ø–∫–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
    <header class="main-header">
        <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" —Å–ª–µ–≤–∞ -->
        <div class="header-buttons left">
            <button id="findUserBtn" class="header-action-btn find-user-btn">–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É -->
        <div class="user-info-header">
            <h3 id="username"></h3>
            <button id="myProfileBtn" class="my-profile-btn" title="–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å">
                <img id="headerAvatarImg" src="/images/profile-default.png" alt="–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å">
            </button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" —Å–ø—Ä–∞–≤–∞ (–≤–º–µ—Å—Ç–æ "–í—ã–π—Ç–∏") -->
        <div class="header-buttons right">
            <button id="settingsBtn" class="header-icon-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
            <div id="settingsDropdown" class="dropdown-menu hidden">
                <div id="dropdownThemeToggle" class="dropdown-item">
                    <span id="themeToggleIcon">üåô</span>
                    –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
                </div>
                <div id="dropdownLogout" class="dropdown-item danger">
                    –í—ã–π—Ç–∏
                </div>
            </div>
        </div>
    </header>

    <!-- –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ó–∞–≥—Ä—É–∑–∫–∞...") -->
    <div id="status" class="status"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –∏ –æ–∫–Ω–æ —á–∞—Ç–∞ -->
    <main class="chat-wrapper">

        <!-- 1. –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (—Å–ª–µ–≤–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ) -->
        <ul id="chatList" class="chat-list">
            <!-- –°—é–¥–∞ JavaScript –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã <li> –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ -->
        </ul>

        <!-- 2. –û–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞ (—Å–ø—Ä–∞–≤–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ, —Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <section id="chatWindow" class="chat-window hidden">

            <!-- –®–∞–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞ -->
            <div class="chat-window__header">
                <button class="back-btn" id="backToListBtn">&larr;</button>

                <div class="chat-title-wrapper">
                    <h2 id="chatTitle">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h2>
                    <button id="profileBtn" class="header-icon-btn" title="–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </button>
                </div>

                <div class="chat-header-actions">
                    <button id="closeChatBtn" class="header-icon-btn" title="–ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
            <div id="messages" class="messages">
                <p class="placeholder">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</p>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–µ–≤—å—é –≤–ª–æ–∂–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π -->
            <div id="attachmentPreviewContainer" class="attachment-preview-container"></div>

            <!-- –§–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è -->
            <form id="messageForm" class="message-form">
                <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ -->
                <input type="file" id="fileInput" hidden multiple>
                <!-- –ö–Ω–æ–ø–∫–∞-—Å–∫—Ä–µ–ø–∫–∞ –¥–ª—è –≤—ã–∑–æ–≤–∞ input'–∞ -->
                <button type="button" id="attachFileBtn" class="attach-btn">üìé</button>
                <!-- –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <textarea id="messageInput" class="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                          rows="1"></textarea>
                <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                <button type="submit" class="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>

        </section> <!-- –ö–æ–Ω–µ—Ü .chat-window -->
    </main> <!-- –ö–æ–Ω–µ—Ü .chat-wrapper -->
</div> <!-- –ö–æ–Ω–µ—Ü .container -->

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
<div id="userSearchModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <button id="closeModalBtn" class="close-btn">&times;</button>
        </div>
        <div id="userListContainer" class="user-list-container">
            <!-- –°—é–¥–∞ JavaScript –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        </div>
    </div>
</div>

<div id="userProfileModal" class="modal hidden">
    <div class="modal-content my-profile-modal-content">
        <div class="modal-header">
            <h2 id="userProfileModalTitle">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            <button id="closeUserProfileBtn" class="header-icon-btn" title="–ó–∞–∫—Ä—ã—Ç—å">
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div id="userProfileContent" class="modal-body user-profile-body">

        </div>
    </div>
</div>

<div id="myProfileModal" class="modal hidden">
    <div class="modal-content my-profile-modal-content">
        <div class="modal-header">
            <h2>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê -->
            <button id="closeMyProfileBtn" class="header-icon-btn" title="–ó–∞–∫—Ä—ã—Ç—å">
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div id="myProfileContent" class="modal-body my-profile-body">
            <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è -->
            <div class="skeleton-list">
                <div class="skeleton skeleton-row" style="height: 80px;"></div>
                <div class="skeleton skeleton-row"></div>
                <div class="skeleton skeleton-row"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="saveMyProfileBtn" class="profile-save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button id="cancelMyProfileBtn" class="profile-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<!-- –û–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
<div id="editUserModal" class="modal hidden">
    <div class="modal-content edit-user-modal-content">
        <div class="modal-header">
            <h2>–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</h2>
            <button id="closeEditUserBtn" class="close-btn">&times;</button>
        </div>
        <form id="editUserForm" novalidate>
            <div class="modal-body">
                <div class="profile-form-group">
                    <label for="editNameInput">–ò–º—è:</label>
                    <input type="text" id="editNameInput" required>
                </div>
                <div class="profile-form-group">
                    <label for="editSurnameInput">–§–∞–º–∏–ª–∏—è:</label>
                    <input type="text" id="editSurnameInput">
                </div>
                <div class="profile-form-group">
                    <label for="editUsernameInput">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <input type="text" id="editUsernameInput" required>
                </div>
                <div id="editUserError" class="error-message hidden"></div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="saveEditUserBtn" class="profile-save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" id="cancelEditUserBtn" class="profile-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>


<script src="/js/lib/sockjs.min.js"></script>
<script src="/js/lib/stomp.min.js"></script>
<script src="/js/apiClient.js"></script> <!-- –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è apiFetch -->
<script src="/js/chats.js"></script>
<script src="/js/current-profile.js"></script>
<script src="/js/photoViewer.js"></script>
<script src="/js/imageLoader.js"></script>
<script src="/js/userProfile.js"></script>


</body>
</html>